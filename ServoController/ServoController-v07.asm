; ******************************************* 
; ** 64 Channel Serial Servo Controller    **
; **           For ATMega168               **
; **            Version 7.0                **
; **                                       **
; **     Copyright (c) November 2009       **
; **             Len Holgate               **
; **                                       **
; ** See http://www.lhexapod.com           **
; **                                       **
; ** Note that this controller assumes     **
; ** that we have CD74HCT238E or equivalent**
; ** demultiplexor chips connected to pins **
; ** 0-4 of Ports B and C and that the     **
; ** required address lines for these MUXs **
; ** are run from pins 2-4 of PortD.       **
; ** See website for a schematic.          **
; *******************************************
;


.nolist
.include "m168def.inc"
.list




.include "PWMAndSerialDefinitions.asm"
.include "SerialDefinitions.asm"


.equ NUM_SERVOS = 64              ; Max 64!

.equ CONFIG_DATA_TABLE_SIZE       = MAX_SERVOS
;.equ SERVO_MAPPING_TABLE_SIZE     = CONFIG_DATA_TABLE_SIZE
;.equ MIN_POSITION_TABLE_SIZE      = CONFIG_DATA_TABLE_SIZE
;.equ MAX_POSITION_TABLE_SIZE      = CONFIG_DATA_TABLE_SIZE
;.equ CENTRE_POSITION_TABLE_SIZE   = CONFIG_DATA_TABLE_SIZE
;.equ DEFAULT_POSITION_TABLE_SIZE  = CONFIG_DATA_TABLE_SIZE
        
.equ CONFIG_DATA_START                     = SRAM_START
.equ CONFIG_DATA_PWM_ACTIVE_ON_RESET       = CONFIG_DATA_START
.equ CONFIG_DATA_SEND_CONTROLLER_ACTIVE    = CONFIG_DATA_START + 1
.equ CONFIG_DATA_SERVO_OUT_OF_RANGE_ACTION = CONFIG_DATA_START + 2
.equ CONFIG_DATA_PWM_CURRENTLY_ACTIVE      = CONFIG_DATA_START + 3
.equ CONFIG_DATA_SIZE                      = 4

.equ SRAM_DEFAULT_POSITION_TABLE_START   = CONFIG_DATA_START + CONFIG_DATA_SIZE
;.equ SRAM_SERVO_MAPPING_TABLE_START      = SRAM_DEFAULT_POSITION_TABLE_START + DEFAULT_POSITION_TABLE_SIZE

.equ EEPROM_CONFIG_DATA_START            = 0x0000
.equ EEPROM_CONFIG_DATA_SIZE             = 3
.equ EEPROM_SERVO_MAPPING_TABLE_START    = EEPROM_CONFIG_DATA_START + CONFIG_DATA_SIZE
.equ EEPROM_MIN_POSITION_TABLE_START     = EEPROM_SERVO_MAPPING_TABLE_START + CONFIG_DATA_TABLE_SIZE
.equ EEPROM_MAX_POSITION_TABLE_START     = EEPROM_MIN_POSITION_TABLE_START + CONFIG_DATA_TABLE_SIZE
.equ EEPROM_CENTRE_POSITION_TABLE_START  = EEPROM_MAX_POSITION_TABLE_START + CONFIG_DATA_TABLE_SIZE
.equ EEPROM_DEFAULT_POSITION_TABLE_START = EEPROM_CENTRE_POSITION_TABLE_START + CONFIG_DATA_TABLE_SIZE


.equ POSITION_DATA_START  = SRAM_DEFAULT_POSITION_TABLE_START + CONFIG_DATA_TABLE_SIZE

.equ POSITION_DATA_END    = POSITION_DATA_START + (NUM_SERVOS * BYTES_PER_SERVO)

.equ PWM_DATA_START       = POSITION_DATA_END
.equ PWM_SERVOS_PER_CYCLE = 8
.equ PWM_BYTES_PER_SERVO  = 3
.equ PWM_DATA_SIZE        = (PWM_SERVOS_PER_CYCLE + 1) * PWM_BYTES_PER_SERVO
.equ PWM_DATA_END         = PWM_DATA_START + PWM_DATA_SIZE

.equ SERIAL_DATA_START    = PWM_DATA_END
.equ SERIAL_DATA_END      = SERIAL_DATA_START + SERIAL_DATA_LENGTH

.equ MULTI_MOVE_WORKSPACE_START            = SERIAL_DATA_END


.equ STACK_START          = RAMEND
.equ STACK_SIZE           = 64
.equ STACK_END            = STACK_START - STACK_SIZE


.equ clock        = 7372800
.equ baudrate     = 9600
.equ baudconstant = (clock/(16*baudrate))-1

.cseg

.include "InterruptVector.asm"

.org INT_VECTORS_SIZE

.include "Initialisation.asm"
.include "SerialCommandAccumulation.asm"
.include "SerialTransmission.asm"
.include "SerialProtocolHandling.asm"
.include "PWMGeneration.asm"
.include "EepromDataStore.asm"

.dseg

.org CONFIG_DATA_START      ; wastefully storing these flags in separate bytes for now
.db 0x00                    ; PWM active on reset 
.db 0x00                    ; Servo out of range action
.db 0x00                    ; Send controller active message
.db 0x00                    ; PWM active now

; Initial start up positions for each servo....
; Loaded from eeprom only if eeprom data isn't the default
; data...

.org SRAM_DEFAULT_POSITION_TABLE_START
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  0 - 7
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  8 - 15
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 16 - 23
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 24 - 31
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 32 - 39
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 40 - 47
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 48 - 55
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 56 - 63

; Initial servo mapping table - default is no mapping
; logical servo number == physical servo number...
; Loaded from eeprom only if eeprom data isn't the default
; data...

;.org SRAM_SERVO_MAPPING_TABLE_START
;.db 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07      ;  0 - 7
;.db 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F      ;  8 - 15
;.db 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17      ; 16 - 23
;.db 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F      ; 24 - 31
;.db 0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27      ; 32 - 39
;.db 0x28, 0x29, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x2F      ; 40 - 47
;.db 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37      ; 48 - 55
;.db 0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F      ; 56 - 63

;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  0 - 7
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  8 - 15
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 16 - 23
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 24 - 31
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 32 - 39
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 40 - 47
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 48 - 55
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 56 - 63

.org POSITION_DATA_START
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  0
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  1
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  2
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  3
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  4
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  5
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  6
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  7
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  8
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo  9
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 10
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 11
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 12
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 13
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 14
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 15
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 16
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 17
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 18
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 19
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 20
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 21
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 22
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 23
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 24
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 25
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 26
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 27
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 28
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 29
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 30
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 31
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 32
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 33
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 34
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 35
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 36
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 37
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 38
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 39
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 40
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 41
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 42
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 43
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 44
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 45
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 46
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 47
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 48
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 49
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 50
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 51
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 52
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 53
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 54
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 55
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 56
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 57
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 58
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 59
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 60
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 61
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 62
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  Servo 63

.org PWM_DATA_START
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  3 bytes per servo
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  per cycle + 3 bytes
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  for the final timer
.db 0x00, 0x00, 0x00

.org SERIAL_DATA_START
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  140 bytes of serial
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  command buffer
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  32
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  64
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  96
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  128
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  
.db 0x00, 0x00, 0x00, 0x00                              ;  140 - this can be smaller if we limit multi move num servos...

.org MULTI_MOVE_WORKSPACE_START                         ;  6 bytes per servo
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  0
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  1
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  2
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  3
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  4
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  5
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  6
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  7
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  8
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo  9
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 10
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 11
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 12
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 13
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 14
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 15
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 16
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 17
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 18
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 19
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 20
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 21
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 22
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 23
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 24
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 25
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 26
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 27
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 28
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 29
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 30
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 31
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 32
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 33
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 34
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 35
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 36
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 37
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 38
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 39
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 40
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 41
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 42
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 43
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 44
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 45
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 46
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 47
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 48
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 49
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 50
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 51
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 52
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 53
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 54
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 55
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 56
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 57
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 58
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 59
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 60
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 61
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 62
;.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                  ;  Servo 63

.org STACK_END
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 
.db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF      ;  Reserved for stack 


; EEPROM data

.eseg

.org EEPROM_CONFIG_DATA_START   ; wastefully storing these flags in separate bytes for now
.db 0x01                        ; PWM active on reset
.db 0x00                        ; Servo out of range action
.db 0x00                        ; Send controller active message

; Initial servo mapping table - default is no mapping
; logical servo number == physical servo number...

.org EEPROM_SERVO_MAPPING_TABLE_START
.db 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07      ;  0 - 7
.db 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F      ;  8 - 15
.db 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17      ; 16 - 23
.db 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F      ; 24 - 31
.db 0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27      ; 32 - 39
.db 0x28, 0x29, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x2F      ; 40 - 47
.db 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37      ; 48 - 55
.db 0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F      ; 56 - 63

; Initial min positions for each servo....

.org EEPROM_MIN_POSITION_TABLE_START
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  0 - 7
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ;  8 - 15
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 16 - 23
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 24 - 31
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 32 - 39
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 40 - 47
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 48 - 55
.db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00      ; 56 - 63

; Initial max positions for each servo....

.org EEPROM_MAX_POSITION_TABLE_START
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ;  0 - 7
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ;  8 - 15
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ; 16 - 23
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ; 24 - 31
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ; 32 - 39
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ; 40 - 47
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ; 48 - 55
.db 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE      ; 56 - 63

; Initial centre positions for each servo....

.org EEPROM_CENTRE_POSITION_TABLE_START
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ;  0 - 7
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ;  8 - 15
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 16 - 23
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 24 - 31
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 32 - 39
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 40 - 47
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 48 - 55
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 56 - 63

; Initial start up positions for each servo....

.org EEPROM_DEFAULT_POSITION_TABLE_START
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ;  0 - 7
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ;  8 - 15
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 16 - 23
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 24 - 31
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 32 - 39
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 40 - 47
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 48 - 55
.db 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F, 0x7F      ; 56 - 63



